pipeline {
  agent any
  tools {
      terraform 'terraform'
  }
  stages{
      stage('Git Checkout'){
          steps {
              git branch: 'SS-3-Samir-Terraform', credentialsId: 'github', url: 'https://github.com/SS-Onboarding-21/SS-Onboarding-21'
          }
      }
      stage('Delete old instance'){
          steps {
              gcloud compute instances delete $(gcloud compute instances list --format='table(name)' | head -n 2| tail -1)
          }
      }
      stage('Terraform Init'){
          steps{
              sh 'terraform init -no-color'
          }
      }
      stage('Terraform Apply') {
        steps {
            sh 'terraform apply --auto-approve -no-color'
        }
      }
  }
}